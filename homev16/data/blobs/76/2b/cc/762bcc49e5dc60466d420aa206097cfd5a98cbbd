<xsl:stylesheet exclude-result-prefixes="#all" version="2.0" xmlns="http://www.w3.org/1999/xhtml" xmlns:util="enonic:utilities" xmlns:portal="http://www.enonic.com/cms/xslt/portal" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:xs="http://www.w3.org/2001/XMLSchema">

    <xsl:template name="mobile.body">
        <!-- Header with logo and search box -->
        <xsl:call-template name="mobile.header" />
        <div id="outer-container" class="clear clearfix">

        <div id="navigation" class="clearfix">
            <ul>
              <li>
                <a href="#" class="show-menu bullet expand">
                  <xsl:value-of select="portal:localize('Show-menu')"/>
                </a>
                <xsl:call-template name="menu.render">
                  <xsl:with-param name="menuitems" select="/result/menu/menuitems"/>
                  <xsl:with-param name="levels" select="3"/>
                  <xsl:with-param name="list-id" select="'menu'" />
                  <xsl:with-param name="list-class" select="'clear'" />
                </xsl:call-template>
              </li>
            </ul>

          </div>
            <!-- Search box -->
            <xsl:if test="$search-result-page != ''">
                <form action="{portal:createUrl($search-result-page)}" method="get" id="page-search-form">
                    <fieldset>
                        <label for="page-search-box">
                            <xsl:value-of select="portal:localize('Search')"/>
                        </label>
                        <input type="text" class="text" name="q" id="page-search-box"/>
                    </fieldset>
                </form>
            </xsl:if>
            <div id="middle-container" class="clear clearfix">
                <xsl:call-template name="region.renderall"/>
            </div>
        </div>
        <!-- Footer -->
        <xsl:call-template name="mobile.footer" />
        <xsl:if test="$google-tracker != ''">
            <xsl:call-template name="google.analytics">
                <xsl:with-param name="google-tracker" select="$google-tracker"/>
            </xsl:call-template>
        </xsl:if>
    </xsl:template>

    <xsl:template name="mobile.scripts">
        <script type="text/javascript">
            <xsl:comment>

                $(function() {

                    $('#navigation').click(function () {
                      $('#menu').slideToggle('fast', function() {
                        var navBar = $('#navigation').children('a');
                        navBar.toggleClass('plus');
                        <!--navBar.toggleClass('minus');-->
                        if ($("#navigation").children("a").text() == "Vis meny") {
                          $("#navigation").children("a").text("Skjul meny");
                        } else {
                          $("#navigation").children("a").text("Vis meny");
                        }
                      });
                    });

                <!-- Validates all forms -->
                $('form:not(.dont-validate)').each(function() {
                $(this).validate({
                ignoreTitle: true,
                errorPlacement: function(label, element) {
                label.insertBefore(element);
                }
                });
                });

                <!-- Adds and localizes datepicker for all date inputs -->
                <xsl:value-of select="concat('$(&quot;.datepicker&quot;).datepicker($.extend({dateFormat: &quot;', portal:localize('jquery-datepicker-date-format'), '&quot;}, $.datepicker.regional[&quot;', $language, '&quot;]));')"/>
                $.validator.addMethod('datepicker', function(value, element) {
                var isValid = true;
                try {
                $.datepicker.parseDate($(element).datepicker('option', 'dateFormat'), value)
                }
                catch(err) {
                isValid = false;
                }
                return isValid;
                }, $.validator.messages.date);

                if ($('.datepicker').length &amp;&amp; $('.datepicker').rules) {
                $('.datepicker').rules('add', {
                datepicker: true
                });
                }

                <!-- Localization of standard jquery.validate messages -->
                jQuery.extend(jQuery.validator.messages, {
                <xsl:value-of select="concat('required: &quot;', portal:localize('jquery-validate-required'), '&quot;,')"/>
                <xsl:value-of select="concat('maxlength: jQuery.validator.format(&quot;', portal:localize('jquery-validate-maxlength'), '&quot;),')"/>
                <xsl:value-of select="concat('minlength: jQuery.validator.format(&quot;', portal:localize('jquery-validate-minlength'), '&quot;),')"/>
                <xsl:value-of select="concat('rangelength: jQuery.validator.format(&quot;', portal:localize('jquery-validate-rangelength'), '&quot;),')"/>
                <xsl:value-of select="concat('email: &quot;', portal:localize('jquery-validate-email'), '&quot;,')"/>
                <xsl:value-of select="concat('url: &quot;', portal:localize('jquery-validate-url'), '&quot;,')"/>
                <xsl:value-of select="concat('date: &quot;', portal:localize('jquery-validate-date'), '&quot;,')"/>
                <xsl:value-of select="concat('dateISO: &quot;', portal:localize('jquery-validate-dateISO'), '&quot;,')"/>
                <xsl:value-of select="concat('number: &quot;', portal:localize('jquery-validate-number'), '&quot;,')"/>
                <xsl:value-of select="concat('digits: &quot;', portal:localize('jquery-validate-digits'), '&quot;,')"/>
                <xsl:value-of select="concat('equalTo: &quot;', portal:localize('jquery-validate-equalTo'), '&quot;,')"/>
                <xsl:value-of select="concat('range: jQuery.validator.format(&quot;', portal:localize('jquery-validate-range'), '&quot;),')"/>
                <xsl:value-of select="concat('max: jQuery.validator.format(&quot;', portal:localize('jquery-validate-max'), '&quot;),')"/>
                <xsl:value-of select="concat('min: jQuery.validator.format(&quot;', portal:localize('jquery-validate-min'), '&quot;),')"/>
                <xsl:value-of select="concat('creditcard: &quot;', portal:localize('jquery-validate-creditcard'), '&quot;')"/>
                });

                });

                //</xsl:comment>
        </script>
    </xsl:template>


    <xsl:template name="mobile.header">


        <div id="header" class="clearfix">
            <a href="{portal:createUrl($front-page)}">
                <img alt="{$site-name}-{portal:localize('logo')}" id="logo" src="{portal:createResourceUrl(concat($theme-public, '/images-mobile/logo.png'))}" title="{$site-name}"/>
            </a>
            <xsl:if test="$user or $login-page">
                <div id="top-menu" class="screen">
                    <xsl:choose>
                        <!-- User logged in -->
                        <xsl:when test="$user">
                            <img src="{if ($user/photo/@exists = 'true') then portal:createImageUrl(concat('user/', $user/@key), 'scalesquare(28);rounded(2)') else portal:createResourceUrl(concat($theme-public, '/images/dummy-user-smallest.png'))}" title="{$user/display-name}" alt="{concat(portal:localize('Image-of'), ' ', $user/display-name)}">
                                <xsl:if test="$login-page">
                                    <xsl:attribute name="class">user-image clickable</xsl:attribute>
                                    <xsl:attribute name="onclick">
                                        <xsl:value-of select="concat('location.href = &quot;', portal:createPageUrl($login-page/@key, ()), '&quot;;')"/>
                                    </xsl:attribute>
                                </xsl:if>
                            </img>
                            <xsl:comment>googleoff: anchor</xsl:comment>
                            <a href="{portal:createServicesUrl('user', 'logout')}">
                                <xsl:value-of select="portal:localize('Logout')"/>
                            </a>
                            <xsl:comment>googleon: anchor</xsl:comment>
                        </xsl:when>
                        <!-- User not logged in -->
                        <xsl:when test="$login-page">
                            <a href="{portal:createPageUrl($login-page/@key, ())}">
                                <xsl:value-of select="portal:localize('Login')"/>
                            </a>
                        </xsl:when>
                    </xsl:choose>
                </div>
            </xsl:if>
        </div>
    </xsl:template>

    <xsl:template name="mobile.footer">
        <div id="footer">
            <p>
                <xsl:if test="$rss-page">
                    <a href="{portal:createUrl($rss-page)}">
                        <img src="{portal:createResourceUrl(concat($theme-public, '/images/icon-rss-large.png'))}" alt="RSS {portal:localize('icon')}"/>
                    </a>
                </xsl:if>
                <xsl:value-of select="portal:localize('footer-text', (year-from-date(current-date())))"/>
            </p>
            <p>
                <a href="{portal:createServicesUrl('portal','forceDeviceClass', ('deviceclass', 'pc', 'lifetime', 'session'))}">
                    <img src="{portal:createResourceUrl(concat($theme-public, '/images-mobile/icon-pc.png'))}" alt="{portal:localize('PC-version')}" class="icon text"/>
                    <xsl:value-of select="portal:localize('Change-to-pc-version')"/>
                </a>
            </p>
        </div>
    </xsl:template>

</xsl:stylesheet>
