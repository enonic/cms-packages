<xsl:stylesheet version="2.0"
                exclude-result-prefixes="#all"
                xmlns:portal="http://www.enonic.com/cms/xslt/portal"
                xmlns:util="enonic:utilities"
                xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

    <xsl:template name="spot-slideshow-jquery-scripts">
        <script  type="text/javascript">
            $(document).ready(function() {
                var currentSlide = 1;
                var totalSlides =  $('figure').size();
                function runSlideshow(){
                    cssTransitionsAvailable = $('html').hasClass('csstransitions');
                    if (cssTransitionsAvailable){
                        slideshowTransitions();
                    }else{
                        slideshowAnimation();
                    }
                }
                function slideshowTransitions(){
                    console.log('Showing image ' + currentSlide + ' of total ' + totalSlides + ' with sweet css3');
                    crossFadeCurrentAndNextSlide();
                    backgroundSlideshow = setTimeout(slideshowTransitions, 5000);
                }
                function slideshowAnimation(){
                    console.log('slideshow animation with javascript');
                }
                function crossFadeCurrentAndNextSlide(){
                    $('#slideshow-image-' + currentSlide +',#slideshow-image-info-'+currentSlide).toggleClass("transparent");
                    currentSlide++;
                    if (currentSlide>totalSlides){currentSlide = 1;}
                    $('#slideshow-image-'+currentSlide+',#slideshow-image-info-'+currentSlide).toggleClass("transparent");
                }
                <!--backgroundSlideshow = setTimeout(runSlideshow, 5000);-->
            });
        </script>
    </xsl:template>

    <xsl:template name="spot-slideshow">
        <xsl:param name="slideshow-images" select="/result/slideshow-images" as="element()*"/>
        <xsl:if test="exists($slideshow-images)">
            <div id="slideshow-images">
                <xsl:for-each select="$slideshow-images/contents/content">
                    <figure style="background-image: url('{portal:createImageUrl(contentdata/image[1]/image/@key, 'scalewidth(1200)','','jpg','50')}')">
                        <xsl:attribute name="class">slideshow-image<xsl:if test="not(position()=1)"><xsl:text> transparent</xsl:text></xsl:if></xsl:attribute>
                        <xsl:attribute name="id">slideshow-image-<xsl:value-of select="position()"/></xsl:attribute>
                        <figcaption>
                            <xsl:attribute name="class">slideshow-image-info<xsl:if test="not(position()=1)"><xsl:text> transparent</xsl:text></xsl:if></xsl:attribute>
                            <xsl:attribute name="id">slideshow-image-info-<xsl:value-of select="position()" /></xsl:attribute>
                            <ul>
                                <li><xsl:value-of select="display-name" /></li>
                                <li><xsl:value-of select="contentdata/image[1]/image_text" /></li>
                            </ul>
                        </figcaption>
                    </figure>
                </xsl:for-each>
                <xsl:call-template name="spot-slideshow-jquery-scripts" />
            </div>
        </xsl:if>
            <!--
            <script  type="text/javascript">
                $(document).ready(function(){

                    Array.prototype.shuffle = function() {
                        var s = [];
                        while (this.length) s.push(this.splice(Math.random() * this.length, 1)[0]);
                        while (s.length) this.push(s.pop());
                        return this;
                    }

                    var images=new Array();
                    var imageId;
                    var imageUrl;

                    <xsl:if test="/result/background-images/contents/relatedcontents/content[@contenttype='Image']">
                        <xsl:for-each select="/result/background-images/contents/relatedcontents/content[@contenttype='Image'] ">
                            imageUrl = "<xsl:value-of select="portal:createImageUrl(current()/@key, 'scalewidth(1200)','','jpg','50')" />";
                            imageId = imageUrl.substring(imageUrl.lastIndexOf('=')+1);
                            $('#footer').append('<figcaption class="photo-info transparent" rel="tempId">"<xsl:value-of select="display-name" />"<xsl:if test="not(contentdata/photographer/@name='')"> by <xsl:value-of select="contentdata/photographer/@name" /></xsl:if></figcaption>');
                            $('figcaption[rel="tempId"]').attr("id",imageId);
                            images[<xsl:value-of select="position()-1"/>] = imageUrl;
                        </xsl:for-each>
                        runSlideshow(images.shuffle());

                    </xsl:if>
                    <xsl:if test="/result/background-images/contents/relatedcontents/content[@contenttype='Image']">
                        <xsl:choose>
                            <xsl:when test="/result/context/resource/type='Spot'">
                                <xsl:variable name="resourceKey" select="/result/context/resource/@key" />
                                <xsl:for-each select="/result/background-images/contents/content[@contenttype='Spot' and @key = $resourceKey]" >
                                    <xsl:for-each select="relatedcontentkeys/relatedcontentkey[@contenttype='Image']">
                                         <xsl:choose>
                                            <xsl:when test="$device-class = 'mobile'">
                                                imageUrl = "<xsl:value-of select="portal:createImageUrl(current()/@key, 'scaleblock(320, 480)','','jpg','50')" />";
                                            </xsl:when>
                                            <xsl:otherwise>
                                                imageUrl = "<xsl:value-of select="portal:createImageUrl(current()/@key, 'scalewidth(1200)','','jpg','50')" />";
                                            </xsl:otherwise>
                                        </xsl:choose>
                                        imageId = imageUrl.substring(imageUrl.lastIndexOf('=')+1);
                                       <xsl:for-each select="/result/background-images/contents/relatedcontents/content[@contenttype='Image' and @key = current()/@key]">
                                            $('#footer').append('<figcaption class="photo-info transparent" rel="tempId">"<xsl:value-of select="display-name" />"<xsl:if test="not(contentdata/photographer/@name='')"> by <xsl:value-of select="contentdata/photographer/@name" /></xsl:if></figcaption>');
                                            $('figcaption[rel="tempId"]').attr("id",imageId);
                                        </xsl:for-each>
                                        images[<xsl:value-of select="position()-1"/>] = imageUrl;
                                    </xsl:for-each>
                                </xsl:for-each>
                            </xsl:when>
                            <xsl:otherwise>
                                <xsl:for-each select="/result/background-images/contents/relatedcontents/content[@contenttype='Image'] ">
                                     <xsl:choose>
                                        <xsl:when test="$device-class = 'mobile'">
                                            imageUrl = "<xsl:value-of select="portal:createImageUrl(current()/@key, 'scaleblock(320, 800)','','jpg','50')" />";
                                        </xsl:when>
                                        <xsl:otherwise>
                                            imageUrl = "<xsl:value-of select="portal:createImageUrl(current()/@key, 'scalewidth(1200)','','jpg','50')" />";
                                        </xsl:otherwise>
                                    </xsl:choose>
                                    imageId = imageUrl.substring(imageUrl.lastIndexOf('=')+1);
                                    $('#footer').append('<figcaption class="photo-info transparent" rel="tempId">"<xsl:value-of select="display-name" />" <xsl:if test="not(contentdata/photographer/@name='')"> by <xsl:value-of select="contentdata/photographer/@name" /></xsl:if></figcaption>');
                                    $('figcaption[rel="tempId"]').attr("id",imageId);
                                    images[<xsl:value-of select="position()-1"/>] = imageUrl;
                                </xsl:for-each>
                            </xsl:otherwise>
                        </xsl:choose>
                        runSlideshow(images.shuffle());
                    </xsl:if>
                });
            </script>
            -->
    </xsl:template>
</xsl:stylesheet>